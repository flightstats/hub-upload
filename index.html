<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name=viewport content="width=device-width, initial-scale=1">

    <title>Hub Upload</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"
      integrity="sha384-R4/ztc4ZlRqWjqIuvf6RX5yb/v90qNGx6fS48N0tRxiGkqveZETq72KgDVJCp2TC"
      crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
      integrity="sha256-KXn5puMvxCw+dAYznun+drMdG1IFl3agK0p/pqT9KAo= sha512-2e8qq0ETcfWRI4HJBzQiA3UoyFk6tbNyG+qSaIBZLyW9Xf3sWZHN/lxe9fTh1U45DpPf07yj94KsUHHWe4Yk1A=="
      crossorigin="anonymous"></script>

    <style>
     .starter-template {
       padding: 40px 15px;
       text-align: center;
     }
     .thumb {
       height: 75px;
       border: 1px solid #000;
       margin: 10px 5px 0 0;
     }
     #file_selector {
       padding: 25px;
       text-align: center;

     }
     #drop_zone {
       border: 2px dashed #bbb;
       -moz-border-radius: 5px;
       -webkit-border-radius: 5px;
       border-radius: 5px;
       padding: 25px;
       text-align: center;
       color: #bbb;
     }
     #uploaded {
       font: 20pt bold 'Vollkorn';
       min-height: 200px;
     }
    </style>

  </head>
  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Hub Upload</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="/">Home</a></li>
            <li><a href="/about">About</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">

      <div class="starter-template">
        <h1>Upload files to the Hub</h1>

        <div class="container">

          <div>
            <div class="form-group">
              <label for="hub_url">Hub URL:</label>
              <input name="hub_url" class="form-control" type="text" value=""/>
            </div>

            <div class="form-group">
              <label for="channel_name">Channel Name</label>
              <input name="channel_name" class="form-control" type="text" value=""/>
            </div>

            <div id="file_selector">
              <input type="file" id="file" name="file[]" />
            </div>

            <div id="drop_zone">
              <output id="uploaded">
                Drop file here
              </output>
            </div>
          </div>

          <script>
           function handleFileSelect(evt) {
             var file = evt.target.files[0];
             displayUploadedFile(file);
           }

           function handleFileDrop(evt) {
             evt.stopPropagation();
             evt.preventDefault();
             var file = evt.dataTransfer.files[0];
             displayUploadedFile(file);
           }

           function handleDragOver(evt) {
             evt.stopPropagation();
             evt.preventDefault();
             evt.dataTransfer.dropEffect = 'copy';
           }

           function displayUploadedFile(file) {
             var reader = new FileReader();
             var output = "";
             var fileBase64 = "";
             var fileDataURL = "";

             reader.onload = function(e) {
               fileDataURL = e.target.result;
               fileBase64 = fileDataURL.split(",")[1];
               fileType = e.target.result.match(/data:(.*);base64/)[1];
               output = '<div>fileType: ' + fileType + '</div>'
               document.getElementById('uploaded').innerHTML = output;
               uploadToHub(fileBase64);
             }
             reader.readAsDataURL(file);
           }

           function uploadToHub(base64) {
             var request = {
               "requests" : [{
                 "image": { "content": base64 },
                 "features" : [{
                   "type": "TEXT_DETECTION",
                   "maxResults": "10"
                 }]
               }]
             }

             var xhr = new XMLHttpRequest();
             /* xhr.open("POST", "/upload", true);*/
             /* xhr.onreadystatechange = function() {*/
             /* if (xhr.readyState == 4 && xhr.status == 200) {*/
             /* var json = JSON.parse(xhr.responseText);*/
             /* if(json.responses.length > 0) {*/
             /* var body = json.responses[0].textAnnotations[0].description;*/
             /* document.getElementById("ocrtext").innerText = body;*/
             /* } else {*/
             /* document.getElementById("ocrtext").innerText = json;*/
             /* }*/
             /* */
             /* }*/
             /* */
             /* }*/
             /* xhr.send(JSON.stringify(request));*/
           }

           // Setup the event listeners.
           var dropZone = document.getElementById('drop_zone');
           dropZone.addEventListener('dragover', handleDragOver, false);
           dropZone.addEventListener('drop', handleFileDrop, false);
           document.getElementById('file').addEventListener('change', handleFileSelect, false);
          </script>
        </div>

      </div>

    </div><!-- /.container -->



  </body>
</html>
